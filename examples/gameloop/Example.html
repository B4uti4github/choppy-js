<!DOCTYPE html>
<!-- This project uses choppy, by the creator B4uti4GD -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Choppy Classes</title>
</head>
<body>
    <canvas id="myCanvas" width="200" height="100">
    Your browser does not support the HTML canvas element.
</canvas>
<script src="../../choppy.js"></script>
<script>
var choppy = new Choppy("myCanvas");

// Inicialización de variables de estado
choppy.isDragging = false;
choppy.rockX = 50;
choppy.rockY = 50;

// Escena 0: Menu
choppy.sceneCreate(`
    // Resetear posición de la roca al volver al menú
    choppy.rockX = 50; 
    choppy.rockY = 50;
    choppy.isDragging = false;

    actualScene.layers[0] = "ctx.fillStyle = 'cyan'; ctx.fillRect(0,0,200,100);";
    actualScene.layers[1] = "ctx.fillStyle = 'green'; ctx.fillRect(0,50,200,50);";
    actualScene.layers[2] = "ctx.fillStyle = 'black'; ctx.font = '12px Arial'; ctx.fillText('Menu', 85, 20); ctx.fillStyle = 'gray'; ctx.fillRect(75, 75, 50, 20); ctx.fillStyle = 'black'; ctx.fillText('Jugar', 85, 90)";

    // Sobrescribimos los eventos para esta escena específicamente
    choppy.canvas.onmousedown = function(e) {
        var rect = choppy.canvas.getBoundingClientRect();
        var x = e.clientX - rect.left;
        var y = e.clientY - rect.top;
        // Botón Jugar
        if (x >= 75 && x <= 125 && y >= 75 && y <= 95) {
            choppy.setScene(1);
        }
    };
    // Limpiamos los otros eventos para que no interfieran en el menú
    window.onmousemove = null;
    window.onmouseup = null;
`, "Menu");

// Escena 1: Cave
choppy.sceneCreate(`
    actualScene.layers[0] = "ctx.fillStyle = 'black'; ctx.fillRect(0,0,200,100);";
    // Dibujo dinámico de la roca
    actualScene.layers[1] = "ctx.fillStyle = 'gray'; ctx.fillRect(" + choppy.rockX + "," + choppy.rockY + ", 20, 20);";
    actualScene.layers[2] = "ctx.fillStyle = 'white'; ctx.fillText('Arrastra la roca', 10, 20); ctx.fillText('Click fuera para salir', 10, 40);";
    setTimeout(function() {
        //nothing for wait
        choppy.canvas.onmousedown = function(e) {
        var rect = choppy.canvas.getBoundingClientRect();
        var x = e.clientX - rect.left;
        var y = e.clientY - rect.top;
        
        // Detectar si clickeas la roca
        if (x >= choppy.rockX && x <= choppy.rockX + 20 && y >= choppy.rockY && y <= choppy.rockY + 20) {
            choppy.isDragging = true;
        } else {
            // Si clickeas fuera de la roca, volvemos al menú (escena 0)
            choppy.setScene(2);
        }
    };

    window.onmousemove = function(e) {
        if (choppy.isDragging) {
            var rect = choppy.canvas.getBoundingClientRect();
            choppy.rockX = (e.clientX - rect.left) - 10;
            choppy.rockY = (e.clientY - rect.top) - 10;
        }
    };

    window.onmouseup = function() {
        choppy.isDragging = false;
    };
    }, 500);
`, "Cave");

choppy.sceneCreate(`
    // Escena de transición para volver al menú
    actualScene.layers[0] = "ctx.fillStyle = 'black'; ctx.fillRect(0,0,200,100);";
    actualScene.layers[1] = "ctx.fillStyle = 'white'; ctx.font = '12px Arial'; ctx.fillText('Volviendo al menú...', 60, 50);";

    // Después de un breve retraso, volver al menú
    setTimeout(function() {
        choppy.setScene(0);
    }, 1000);
`, "Return to Menu");

choppy.play();

</script>
</body>
</html>